{
    "collab_server" : "",
    "contents" : "---\ntitle: \"ITNr\"\noutput: github_document\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\n```\n\n# ITNr - International Trade Network (ITN) analysis in R\nInternational trade data can be analysed using a network perspective, where the network is a set of countries linked by weighted and directed trade ties. This network is referred to by various names, the International Trade Network (ITN), World Trade Web (WTW) and the World Trade Network (WTN) etc.  \nThis package provides a number of functions for cleaning and processing international trade data into a network, and undertaking a set of relevant analysis. \n\n## Packages\nThis package uses a number of other packages.\n```{r packages,eval=FALSE}\nlibrary(igraph)\nlibrary(dplyr)\nlibrary(plyr)\nlibrary(fastmatch)\nlibrary(WDI)\nlibrary(ggplot2)\nlibrary(GGally)\nlibrary(cowplot)\nlibrary(intergraph)\nlibrary(sna)\nlibrary(xergm)\nlibrary(ndtv)\nlibrary(networkDynamic)\nlibrary(tnet)\nlibrary(blockmodeling)\nlibrary(GoodmanKruskal)\nlibrary(reshape2)\n\n#Install this package:\n#library(devtools)\n#devtools::install_github(\"MatthewSmith430/ITNr\")\n\nlibrary(ITNr)\n```\n\n## Loading Example Data\nThis package comes with example International Trade Network data. The network data is trade in electrical automotive goods, where this category is defined by Amighini & Gorgoni (2014):  \nAmighini, A. and Gorgoni, S. (2014) The International Reorganisation of Auto Production, The World Economy, 37(7), pp. 923–952.  \n\nThese ITNs are igraph objects with a number of attributes (region, GDP, GDP per captia etc). The edge weights are proportion of global trade in the electrical automotive goods category group. A threshold has been applied to the edge weights so only the most relevant edges and countries are included in the network. Therefore only edges that are at least 0.01% of global trade are included in the network.   \n\nThe first object is a single network for 2016, the second is a list of networks for 2006 - 2016.\n\n```{r data,eval=FALSE}\n#Single ITN 2016 \ndata(\"ELEnet16\")\n\n#List of ITNs 2006 - 2016\ndata(\"ELEnetList\")\n```\n\n## Cleaning international trade data\nThis function can clean a CSV file downloaded from WITS (<https://wits.worldbank.org/>) and process it into an igraph object with a number of attributes attached. \nThe attributes the function attaches include  \n- Region  \n- Income Level  \n- GDP  \n- GDP per capita  \n- GDP growth  \n- FDI  \n\nThe network is also weighted, where the weights refer to the proportion of world trade (of the product).  \n\nThe function requires a number of inputs:  \n- CSV file name  \n\n- Year (as the csv file may contain trade data for multiple years, this therefore allows you to create a ITN for a single year from this CSV file)  \n\n- Threshold TRUE/FALSE. TRUE - you want to apply a threshold with a cutoff. FALSE - instead of applying a threshold you extract the backbone of the network, retaining only statistically significant edges.  \n\n- Cutoff - for the threshold TRUE this is the cutoff point, for FALSE  this is the significance level for the backbone.  \n\nReference for extracting the backbone of a network: Serrano, M. Á., Boguñá, M. and Vespignani, A. (2009) Extracting the multiscale backbone of complex weighted networks, Proceedings of the National Academy of Sciences, 106(16), pp. 6483–6488.  \n\nBelow is an example:\n```{r WITSclean,eval=FALSE}\n#Example\n#Year - 2016\n#Threshold - TRUE\n#Cutoff - 0.01 (Only ties that are at least 0.01% of world trade are retained)\n\nITN<-WITSclean(\"CSV file name.csv\",2016,TRUE,0.01)\n```\n\nThe following functions in the package assume that the ITN specified is one create using the `WITSclean` function.  \n\n## International Trade Network Plots\nThis package contains two functions for plotting the International Trade Networks:  \n1. Plot set  \n2. Single Plot\n\nThe first produces a panel with four network plots. The purpose of this function for a quick inspection of the network structure, whilst the second plot function provides a better, higher quality plot. \n\n### Plot Set\nIn the plot set function, the four plots produced include:  \n- Network plot highlighting clusters using the fast greedy algorithm.  \n\n- Network plot with node colours for communities detected using the spinglass algorithm.  \n\n- Network plot with nodes coloured by regional partition.  \n\n- Network plot with nodes coloured by regional partition and node size based on outdegree centrality.  \n\n```{r plotsnet, echo=TRUE,message=FALSE,warning=FALSE}\nlibrary(ITNr)\n\ndata(\"ELEnet16\")\n\nITNplotset(ELEnet16)\n\n```\n\n### Single Plot\nThis provides a single network plot, where it requires you to specify whether the nodes should be coloured by region and whether labels should be present.  \n\nIf the nodes are coloured by region, the ties between countries in the same region (intra-regional) are the same colour as the node, and all other ties (inter-regional) are grey.  \n\nNode size is based on weighted out degree centrality - so reflects export performance. The edge size is based on the weights of the ties.  \n\nIn the example below the ITN is coloured by region and the node labels are not present.  \n```{r plotsingle, echo=TRUE,message=FALSE,warning=FALSE}\nlibrary(ITNr)\ndata(\"ELEnet16\")\n\n#No labels and node coloured by region\nITN_make_plot(ELEnet16,FALSE,TRUE)\n```\n\n## Degree Distribtuion\nWe often want to examine the degree distribution of the ITN - that it the distribution of import and export ties. We present two plots of the degree distribution: probability and histogram.  \n\n### Probability Plot\nThis plot shows the probability of degree scores over the whole network.  \n```{r plotpro, echo=TRUE,message=FALSE,warning=FALSE}\nlibrary(ITNr)\ndata(\"ELEnet16\")\n\nITNdegdist(ELEnet16)\n```\n\n### Histogram Plot  \nThis plot shows the count/number of degree scores over the whole network. \n```{r plothist, echo=TRUE,message=FALSE,warning=FALSE}\nlibrary(ITNr)\ndata(\"ELEnet16\")\n\nITNhistdegdist(ELEnet16)\n```\n\n## Imports Vs Exports Plot\nThe following function produces a plot showing imports (in degree) vs exports (out degree). This allows us to identify whether in the ITN, countries that export high levels also import high levels. The plot can be produced for either weighted or binary import and export ties.  \n```{r plotImEx, echo=TRUE,message=FALSE,warning=FALSE}\nlibrary(ITNr)\ndata(\"ELEnet16\")\n\n#Plot is for binary imports and exports\nITNimvex(ELEnet16,FALSE)\n```\n\n## Node Strength - Degree Correlation Plot\nThe following function creates a correlation plot to examine the correlation between node strength and node degree.\n\n```{r STRDEGPLOT, echo=TRUE,message=FALSE,warning=FALSE}\nlibrary(ITNr)\ndata(\"ELEnet16\")\n\nITNcorr(ELEnet16)\n```\n\n## Network Analysis\nInitial analysis of the ITN often involves calculating network level properties and calculating a variety of centrality measures for countries. \n\n### Network Properties\nThe network level properties calculated for the ITN include:  \n- Size (number of nodes)  \n- Density  \n- Reciprocity  \n- Diameter  \n- Average path length  \n- Average node strength  \n- Average Degree  \n- Betweenness Centralisation  \n- Closeness Centralisation  \n- Eigenvector Centralisation  \n- Out Degree Centralisation  \n- In Degree Centralisation  \n- All Degree Centralisation  \n- Clustering coefficient (transitivity)  \n- Clustering Weighted  \n- Region Homophily  \n- Degree Assortativity  \n\n```{r netprop, echo=TRUE,message=FALSE,warning=FALSE}\nlibrary(ITNr)\ndata(\"ELEnet16\")\n\nNetProp<-ITNproperties(ELEnet16)\n\nhead(NetProp)\n```\n\n### Centrality  \nWe present a function that calculates several centrality metrics for the ITN. These capture the importance of countries in the ITN, with a focus on their export or import performance for the majority of measures. \n```{r cent, echo=TRUE,message=FALSE,warning=FALSE}\nlibrary(ITNr)\ndata(\"ELEnet16\")\n\nCENT<-ITNcentrality(ELEnet16)\n\nhead(CENT)\n```\n\n### Brokerage Roles\nIt can be important to analyse brokerage roles in the ITN, where we consider a country's role as a broker between various regional partitions. The following function conducts the Gould & Fernandez (1989) brokerage analysis.  \nGould, R. V. and Fernandez, R. M. (1989) Structures of mediation: A formal approach to brokerage in transaction networks, Sociological methodology, 19(1989), pp. 89–126.  \n\nIn this function - you specify the network (igraph object with region attribute) and the name of the file, where the analysis is saved.\n```{r GFbroker,eval=FALSE}\nGFbroker<-RegionalBrokerage(ITN,\"ITN Regional Brokerage\")\n```\n\n### Clustering\nIn the plots section we plotted networks with nodes coloured by clusters. In this function, we present the cluster membership for each country for a variety of cluster algorithms. We also present correlation between cluster membership and regional partitions. This allows you to investigate whether clustering in the ITN occurs at the regional level.  \n```{r CLUSTERcalc,eval=FALSE}\n\nCLU<-ITNcluster(ELEnet16)\n\n```\n\n### Blockmodels and Structural Equivalence \nBlockmodelling and structural equivalence are important concepts in international trade. Blockmodels indicates the.  \nStructural equivalence allows us to explore to what extent two countries hold equivalent positions in the ITN.  \nThis function gives the block membership for each country and a structural equivalence matrix, which indicates how equivalent pairs of countries are in the ITN.  \n```{r BLOCKSE,eval=FALSE}\nblockse<-ITNblock_se(ELEnet16)\n```\n\n#### Blockmodel Plot\nIn addition to calculating the blockmodel membership, we introduce a function to plot the ITN with node coloured by block membership.  \nYou can also set whether you want node labels present(TRUE) or absent (FALSE).  \n```{r plotBLOCK, echo=TRUE,message=FALSE,warning=FALSE}\nlibrary(ITNr)\ndata(\"ELEnet16\")\n\n#No labels \nITNblock_plot(ELEnet16,FALSE)\n```\n\n## Longitudinal Network Analysis  \nTrade data is available for decades, therefore longitudinal analysis is also available. Here we present function on how to create a dynamic network object based on a set of (temporal) ITNs (e.g. one ITN for each year).   \n\nTo create a dynamic network object, we need to specify a list of ITNs. These are usually an ITN for each year, where they are trade in the same product groups across time.  \n```{r DYN,eval=FALSE}\n\n##Load a list of ITNs - this is 11 ITNs, one for each year for 2006-2016\ndata(\"ELEnetList\")\n\n##Create a dynamic network object for the list of ITNs\nITNdyn<-ITNdynamic(ELEnetList)\n\n##We can also inspect this dynamic network object\nhead(as.data.frame(ITNdyn))\n```\n\n### Dynamic Network Analysis & Animation\nThere are many additional packages and functions to analyse this dynamic network object. These are listed at:<http://statnet.csde.washington.edu/workshops/SUNBELT/current/ndtv/ndtv_workshop.html#introduction-to-this-workshop>  \n\nBelow is some example code to complement this package and analyse the dynamic network ITN object. \n\n#### Film Strip Plots\nFilm strip plots can be used to create a static plot of a series of dynamic networks. Below is the code to create a film strip plot from a dynamic network object.\n```{r FILM,eval=FALSE}\n##Create a dynamic network object for the list of ITNs\nITNdyn<-ITNdynamic(ELEnetList)\n\npar(mar=c(1,1,1,1))\n\nfilmstrip(ITNdyn,displaylabels=FALSE,vertex.cex=2,\n          edge.col=\"#CCCCCC55\",vertex.col='red')\n\ntitle(\"filmstrip example\")\n\n```\n\n#### Animation\nThe dynamic network object can be used to create network animations using the networkDynamic and ndtv packages. There are other tools available to create network animations - that do not use a dynamic network object, see <http://curleylab.psych.columbia.edu/netviz/netviz5.html#/10> for these alternative approaches.  \n\nTo save the animations different file formats you need to have image magik installed, (<https://www.imagemagick.org/script/index.php>). When installing check the \"install legacy programs\" box. You also need to installation directory to path in Environment Variables. \n\n```{r ANIMATION,eval=FALSE}\n##Create a dynamic network object for the list of ITNs\nITNdyn<-ITNdynamic(ELEnetList)\n\nrender.d3movie(ITNdyn,\n               render.par=list(tween.frames=20),\n               vertex.cex=0.8,\n               vertex.col='red',\n               edge.col=\"#CCCCCC55\",\n               output.mode = 'htmlWidget')\n\n##Commands to save animation as GIF (to insert in presentations)\nsaveGIF(render.animation(ITNdyn,\n                       render.par=list(tween.frames=20),\n                       vertex.cex=0.8,vertex.col='red',\n                       edge.col=\"#CCCCCC55\"),movie.name = \"Example.gif\")\n\n```\n\n\n#### Temporal Metrics\nThese commands include timeline options, where we can view the dynamics of a network as a timeline by plotting the active spells of edges and vertices.\n\nWe can also make use of the `tsna` package to undertake some basic temporal social network analysis. This includes examining how many edges form at each time step for the dynamic network object (`tEdgeFormation`) and producing a plot of this information. \nThe `tsna` package allows us to compute a time series using network configuration terms (terms specified in the `ergm` package). In the example below the `gtrans` function to calculate and plot transitivity in the networks over time.\n```{r TEMPMET,eval=FALSE}\n##Create a dynamic network object for the list of ITNs\nITNdyn<-ITNdynamic(ELEnetList)\n\n##Timeline Plots\ntimeline(ITNdyn)\ntimeline(ITNdyn,plot.edge.spells=FALSE)\n\n#tsna - Temporal Social Network Analysis\nlibrary(tsna)\ntEdgeFormation(ITNdyn)\nplot(tEdgeFormation(ITNdyn))\n\ntSnaStats(ITNdyn,'gtrans')\nplot(tSnaStats(ITNdyn,'gtrans'))\n\n```\n\n",
    "created" : 1524588596673.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1078284223",
    "id" : "CB9ACF08",
    "lastKnownWriteTime" : 1524589117,
    "last_content_update" : 1524589117590,
    "path" : "~/GitHub/ITNr/README.Rmd",
    "project_path" : "README.Rmd",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}